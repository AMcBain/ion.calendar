// Ion.Calendar
// version 1.0.45
// http://ionden.com/a/plugins/ion.calendar/
(function(j){j.fn.ionCalendar=function(f){var b=this,g=j.extend({lang:"ru",format:"D.M.YYYY",onUpdate:null,onClick:null},f);moment.lang(g.lang);var a='<div class="ion_calendar_head">',a=a+'<div class="ion_calendar_top_date">loading</div>',a=a+'<div class="ion_arr ion_arr_prev">&lt;</div>',a=a+'<div class="ion_arr ion_arr_next">&gt;</div>',a=a+'<input class="ion_set_year" type="text" maxlength="4" value="" />',a=a+"</div>",a=a+'<div class="ion_week"></div>',a=a+'<div class="ion_month"></div>';f=moment();
var d='<table class="ion_table_week"><tr>',d=d+("<td>"+f.day(1).format("dd")+"</td>"),d=d+("<td>"+f.day(2).format("dd")+"</td>"),d=d+("<td>"+f.day(3).format("dd")+"</td>"),d=d+("<td>"+f.day(4).format("dd")+"</td>"),d=d+("<td>"+f.day(5).format("dd")+"</td>"),d=d+("<td>"+f.day(6).format("dd")+"</td>"),d=d+("<td>"+f.day(0).format("dd")+"</td>"),d=d+"</tr></table>";({init:function(){var e=this;b.addClass("ion_calendar");b.html(a);this.field_year=b.find(".ion_calendar_top_date");this.input_year=b.find(".ion_set_year");
this.btn_prev=b.find(".ion_arr_prev");this.btn_next=b.find(".ion_arr_next");this.week_content=b.find(".ion_week");this.days_content=b.find(".ion_month");this.baseDate=moment();this.currentDate=moment(this.baseDate);this.update();this.btn_prev.on("mousedown",function(c){c.preventDefault();e.currentDate.subtract("months",1);e.update()});this.btn_next.on("mousedown",function(c){c.preventDefault();e.currentDate.add("months",1);e.update()});this.field_year.on("mousedown",function(c){c.preventDefault();
e.openYear()});this.input_year.on("focusout",function(){e.setYear("none")});this.input_year.on("keydown",function(c){13==c.keyCode&&e.setYear(j(this).val())})},openYear:function(){this.input_year.val(this.currentDate.format("YYYY"));this.input_year.css("display","block");this.input_year.focus()},setYear:function(e){var c=moment(this.currentDate);c.year(e);c.isValid()&&(this.currentDate.year(e),this.update());this.input_year.css("display","none")},update:function(){this.field_year.html(this.currentDate.format("MMMM YYYY"));
this.input_year.val(this.currentDate.format("YYYY"));this.week_content.html(d);var e=moment(this.currentDate),c=moment(e.startOf("month")),c=parseInt(c.format("d"));0==c&&(c=7);var a=moment(e.endOf("month")),e=parseInt(a.format("D")),a=parseInt(a.format("d"));0==a&&(a=7);for(var f=c-1+e+(7-a),b='<table class="ion_table_days"><tr>',h=1;h<=f;h++)a=h+1-c,b=0>=a||a>e?b+'<td class="ion_no_day">&nbsp;</td>':this.currentDate.format("YYYY")==this.baseDate.format("YYYY")&&this.currentDate.format("MM")==this.baseDate.format("MM")&&
a==this.baseDate.format("D")?b+('<td class="ion_day ion_current_day">'+a+"</td>"):b+('<td class="ion_day">'+a+"</td>"),h/7==Math.ceil(h/7)&&(b+="</tr><tr>");this.days_content.html(b+"</tr></table>");"function"==typeof g.onUpdate&&g.onUpdate.call(this,this.currentDate.format(g.format));"function"==typeof g.onClick&&this.datePick()},datePick:function(){var a=this;b.addClass("ion_datepicker");this.days_content.find(".ion_day").on("click",function(){var c=parseInt(j(this).text()),b=moment(a.currentDate);
b.date(c);g.onClick.call(a,b.format(g.format))})}}).init()}})(jQuery);